{
  "id": "pii-scrubbing-rust",
  "name": "PII Scrubbing (Rust)",
  "description": "Remove sensitive data (emails, API keys, tokens) from Rust error events before sending to Sentry",
  "type": "beforeSend",
  "sdk": "rust",
  "event": {
    "event_id": "rust-pii-456",
    "message": "Authentication failed",
    "exception": {
      "values": [
        {
          "type": "AuthError",
          "value": "Invalid API key: sk_live_abc123xyz"
        }
      ]
    },
    "extra": {
      "user_email": "user@example.com",
      "api_key": "sk_live_abc123xyz",
      "session_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9"
    },
    "user": {
      "email": "user@example.com",
      "ip_address": "192.168.1.100"
    }
  },
  "beforeSendCode": "// Redact email in user object\nif let Some(user) = event.get_mut(\"user\") {\n    if user.get(\"email\").is_some() {\n        user[\"email\"] = json!(\"[REDACTED]\");\n    }\n    // Remove IP address\n    if let Some(obj) = user.as_object_mut() {\n        obj.remove(\"ip_address\");\n    }\n}\n\n// Redact sensitive extra data\nif let Some(extra) = event.get_mut(\"extra\") {\n    if extra.get(\"api_key\").is_some() {\n        extra[\"api_key\"] = json!(\"[REDACTED]\");\n    }\n    if extra.get(\"session_token\").is_some() {\n        extra[\"session_token\"] = json!(\"[REDACTED]\");\n    }\n    if extra.get(\"user_email\").is_some() {\n        extra[\"user_email\"] = json!(\"[REDACTED]\");\n    }\n}\n\n// Scrub exception messages containing API keys\nif let Some(exception) = event.get_mut(\"exception\") {\n    if let Some(values) = exception.get_mut(\"values\") {\n        if let Some(arr) = values.as_array_mut() {\n            for exc in arr {\n                if let Some(value) = exc.get(\"value\").and_then(|v| v.as_str()) {\n                    let cleaned = value.replace(\"sk_live_abc123xyz\", \"[REDACTED_KEY]\");\n                    exc[\"value\"] = json!(cleaned);\n                }\n            }\n        }\n    }\n}\n\nSome(event)"
}
