{
  "id": "unity-cleanup",
  "name": "Unity Metadata Cleanup",
  "description": "Extract device metadata from messy Unity/Android crash titles into searchable tags, then parse the actual exception for a clean issue title",
  "type": "fingerprinting",
  "sdk": "javascript",
  "complexity": "intermediate",
  "event": {
    "event_id": "4ac65cab-f83d-4727-b1c5-82a35f9a31d3",
    "timestamp": "2026-01-22T12:30:00.000Z",
    "platform": "android",
    "level": "fatal",
    "exception": {
      "values": [
        {
          "type": "UnityException",
          "value": "FATAL EXCEPTION [RxComputationThreadPool-1] Unity version : 6000.2.14f1 Device model : samsung SM-A022M Device fingerprint: samsung/a02ub/a02:11/RP1A.200720.012/A022MUBS4BWL2:user/release-keys CPU supported ABI : [armeabi-v7a, armeabi] Build Type : Release Scripting Backend : IL2CPP Libs loaded from : Unknown Strip Engine Code : Undefined Resources$NotFoundException: File resource not found"
        }
      ]
    }
  },
  "beforeSendCode": "(event, hint) => {\n  if (!event.exception?.values) return event;\n\n  for (const exception of event.exception.values) {\n    const val = exception.value || '';\n    \n    // Only process Unity metadata dumps\n    if (!val.includes('Unity version')) continue;\n\n    // Store original for debugging\n    event.extra = { ...event.extra, original_exception: val };\n    event.tags = event.tags || {};\n\n    // Extract metadata into searchable tags\n    const patterns = {\n      'thread': /\\[([^\\]]+)\\]/,\n      'unity.version': /Unity version\\s*:\\s*([\\d.]+\\w*)/,\n      'device.model': /Device model\\s*:\\s*([^\\s]+\\s+[^\\s]+)/,\n      'device.abi': /CPU supported ABI\\s*:\\s*\\[([^\\]]+)\\]/,\n      'unity.build_type': /Build Type\\s*:\\s*(\\w+)/,\n      'unity.scripting_backend': /Scripting Backend\\s*:\\s*(\\w+)/\n    };\n\n    for (const [tag, regex] of Object.entries(patterns)) {\n      const match = val.match(regex);\n      if (match) event.tags[tag] = match[1].trim();\n    }\n\n    // Extract the actual exception (usually at the end)\n    const exceptionMatch = val.match(/([\\w.$]+(?:Exception|Error)):\\s*(.+?)\\s*$/);\n    if (exceptionMatch) {\n      exception.type = exceptionMatch[1];\n      exception.value = exceptionMatch[2];\n    } else {\n      exception.type = 'NativeCrash';\n      exception.value = 'Android Native Crash';\n    }\n  }\n\n  return event;\n}"
}
