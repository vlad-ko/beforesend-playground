{
  "id": "go-service-metadata",
  "name": "Go Service Metadata & Infrastructure",
  "description": "Add Go microservice context (service name, version, deployment, Kubernetes pod info) for distributed systems debugging",
  "sdk": "go",
  "event": {
    "event_id": "go-service-222",
    "message": "gRPC request failed: context deadline exceeded",
    "exception": {
      "values": [
        {
          "type": "DeadlineExceeded",
          "value": "rpc error: code = DeadlineExceeded desc = context deadline exceeded"
        }
      ]
    },
    "request": {
      "url": "grpc://order-service:50051/orders.OrderService/GetOrder",
      "method": "POST"
    }
  },
  "beforeSendCode": "package main\n\nimport (\n    \"github.com/getsentry/sentry-go\"\n    \"os\"\n    \"runtime\"\n    \"time\"\n)\n\n// Service metadata (typically loaded from config/env at startup)\ntype ServiceMetadata struct {\n    Name            string\n    Version         string\n    Environment     string\n    DeploymentID    string\n    GitCommit       string\n    BuildTime       string\n    PodName         string\n    PodNamespace    string\n    NodeName        string\n    ClusterName     string\n}\n\nvar serviceMetadata = ServiceMetadata{\n    Name:         os.Getenv(\"SERVICE_NAME\"),\n    Version:      os.Getenv(\"SERVICE_VERSION\"),\n    Environment:  os.Getenv(\"ENVIRONMENT\"),\n    DeploymentID: os.Getenv(\"DEPLOYMENT_ID\"),\n    GitCommit:    os.Getenv(\"GIT_COMMIT\"),\n    BuildTime:    os.Getenv(\"BUILD_TIME\"),\n    PodName:      os.Getenv(\"POD_NAME\"),\n    PodNamespace: os.Getenv(\"POD_NAMESPACE\"),\n    NodeName:     os.Getenv(\"NODE_NAME\"),\n    ClusterName:  os.Getenv(\"CLUSTER_NAME\"),\n}\n\nfunc beforeSend(event *sentry.Event, hint *sentry.EventHint) *sentry.Event {\n    // Add service identification tags\n    event.Tags[\"service.name\"] = serviceMetadata.Name\n    event.Tags[\"service.version\"] = serviceMetadata.Version\n    event.Tags[\"service.environment\"] = serviceMetadata.Environment\n    event.Tags[\"deployment.id\"] = serviceMetadata.DeploymentID\n    event.Tags[\"git.commit\"] = serviceMetadata.GitCommit[:7] // Short commit hash\n\n    // Add Kubernetes context\n    if serviceMetadata.PodName != \"\" {\n        event.Tags[\"k8s.pod.name\"] = serviceMetadata.PodName\n        event.Tags[\"k8s.namespace\"] = serviceMetadata.PodNamespace\n        event.Tags[\"k8s.node\"] = serviceMetadata.NodeName\n        event.Tags[\"k8s.cluster\"] = serviceMetadata.ClusterName\n\n        event.Extra[\"kubernetes\"] = map[string]interface{}{\n            \"pod_name\":      serviceMetadata.PodName,\n            \"pod_namespace\": serviceMetadata.PodNamespace,\n            \"node_name\":     serviceMetadata.NodeName,\n            \"cluster_name\":  serviceMetadata.ClusterName,\n        }\n    }\n\n    // Add deployment metadata\n    event.Extra[\"deployment\"] = map[string]interface{}{\n        \"id\":         serviceMetadata.DeploymentID,\n        \"git_commit\": serviceMetadata.GitCommit,\n        \"build_time\": serviceMetadata.BuildTime,\n    }\n\n    // Add Go runtime information\n    event.Extra[\"runtime\"] = map[string]interface{}{\n        \"go_version\":      runtime.Version(),\n        \"go_os\":           runtime.GOOS,\n        \"go_arch\":         runtime.GOARCH,\n        \"num_cpu\":         runtime.NumCPU(),\n        \"num_goroutine\":   runtime.NumGoroutine(),\n        \"compiler\":        runtime.Compiler,\n    }\n\n    // Add memory statistics\n    var memStats runtime.MemStats\n    runtime.ReadMemStats(&memStats)\n    event.Extra[\"memory\"] = map[string]interface{}{\n        \"alloc_mb\":        memStats.Alloc / 1024 / 1024,\n        \"total_alloc_mb\":  memStats.TotalAlloc / 1024 / 1024,\n        \"sys_mb\":          memStats.Sys / 1024 / 1024,\n        \"num_gc\":          memStats.NumGC,\n        \"gc_cpu_fraction\": memStats.GCCPUFraction,\n    }\n\n    // Add service uptime\n    event.Extra[\"service_uptime_seconds\"] = time.Since(startTime).Seconds()\n\n    // Add instance-specific metadata\n    hostname, _ := os.Hostname()\n    event.Extra[\"instance\"] = map[string]interface{}{\n        \"hostname\":  hostname,\n        \"pid\":       os.Getpid(),\n        \"start_time\": startTime.Format(time.RFC3339),\n    }\n\n    // Add feature flags\n    event.Extra[\"feature_flags\"] = map[string]bool{\n        \"use_new_cache\":        true,\n        \"enable_grpc_tracing\":  true,\n        \"circuit_breaker\":      false,\n    }\n\n    // Add service dependencies health\n    event.Extra[\"dependencies\"] = map[string]interface{}{\n        \"database\":     \"healthy\",\n        \"redis\":        \"healthy\",\n        \"message_queue\": \"degraded\",\n    }\n\n    // Add request context if available from hint\n    if hint != nil && hint.Context != nil {\n        if requestID, ok := hint.Context.Value(\"request_id\").(string); ok {\n            event.Tags[\"request_id\"] = requestID\n            event.Extra[\"request_id\"] = requestID\n        }\n        \n        if traceID, ok := hint.Context.Value(\"trace_id\").(string); ok {\n            event.Tags[\"trace_id\"] = traceID\n            event.Extra[\"trace_id\"] = traceID\n        }\n    }\n\n    // Add service tier/criticality\n    event.Tags[\"service.tier\"] = \"critical\"\n    event.Tags[\"service.team\"] = \"backend-team\"\n\n    // Add load metrics\n    event.Extra[\"load\"] = map[string]interface{}{\n        \"requests_per_second\": getCurrentRPS(),\n        \"error_rate\":          getCurrentErrorRate(),\n        \"avg_response_time_ms\": getAvgResponseTime(),\n    }\n\n    return event\n}\n\n// Helper functions (would be implemented elsewhere)\nvar startTime = time.Now()\n\nfunc getCurrentRPS() float64 { return 125.5 }\nfunc getCurrentErrorRate() float64 { return 0.02 }\nfunc getAvgResponseTime() float64 { return 45.3 }"
}
