{
  "id": "rust-service-metadata",
  "name": "Service Metadata Enrichment (Rust)",
  "description": "Add service version, build info, and deployment context to Rust error events",
  "type": "beforeSend",
  "sdk": "rust",
  "event": {
    "event_id": "rust-meta-789",
    "message": "Database connection timeout",
    "exception": {
      "values": [
        {
          "type": "DbError",
          "value": "Failed to connect to postgres://db.example.com:5432"
        }
      ]
    },
    "level": "error"
  },
  "beforeSendCode": "use serde_json::json;\n\n// Add service version and build information\nif !event.as_object()?.contains_key(\"tags\") {\n    event[\"tags\"] = json!({});\n}\n\nlet tags = event[\"tags\"].as_object_mut()?;\ntags.insert(\"service_version\".to_string(), json!(\"1.2.3\"));\ntags.insert(\"build_number\".to_string(), json!(\"42\"));\ntags.insert(\"rust_version\".to_string(), json!(\"1.75.0\"));\ntags.insert(\"deployment\".to_string(), json!(\"kubernetes\"));\n\n// Add custom context with deployment details\nif !event.as_object()?.contains_key(\"contexts\") {\n    event[\"contexts\"] = json!({});\n}\n\nlet contexts = event[\"contexts\"].as_object_mut()?;\ncontexts.insert(\"deployment\".to_string(), json!({\n    \"cluster\": \"production-us-east-1\",\n    \"pod_name\": \"api-service-abc123\",\n    \"namespace\": \"production\"\n}));\n\ncontexts.insert(\"service\".to_string(), json!({\n    \"name\": \"rust-api-service\",\n    \"version\": \"1.2.3\",\n    \"language\": \"rust\"\n}));\n\n// Add extra metadata\nif !event.as_object()?.contains_key(\"extra\") {\n    event[\"extra\"] = json!({});\n}\n\nlet extra = event[\"extra\"].as_object_mut()?;\nextra.insert(\"compiled_at\".to_string(), json!(\"2026-01-24T12:00:00Z\"));\nextra.insert(\"optimization_level\".to_string(), json!(\"release\"));\n\nSome(event)"
}
